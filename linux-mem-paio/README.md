# mem-paio

## 概要

物理アドレスでメモリを I/O するための Linux 用プログラムです。

- メモリアクセスは `/dev/mem` または `/dev/uio*` を `mmap` して行うことを想定しています
- UIO の場合は、あらかじめ Generic UIO デバイスの登録が必要です

#### ビルド

クロスコンパイルの場合は `Makefile` 内の `CC` や `CROSS_COMPILE` などを適宜修正してください。

```
$ make
```

`mem-paio.elf` が作成されます。

#### 操作

コマンド引数の書式は `[OPTIONS] CMD ADDRESS COUNT` または `[OPTIONS] CMD ADDRESS VALUE...` 形式です。

- `OPTIONS` に、 `--dev PATH` で UIO デバイスのパスを指定することができます。
  - 指定しない場合は `/dev/mem` を使います

- `CMD`: 定義済みの名称で指定します
  - `"RB"` :  8bit サイズでの読み出し
  - `"RW"` : 16bit サイズでの読み出し
  - `"RD"` : 32bit サイズでの読み出し
  - `"RQ"` : 64bit サイズでの読み出し
  - `"WB"` :  8bit サイズでの書き込み
  - `"WW"` : 16bit サイズでの書き込み
  - `"WD"` : 32bit サイズでの書き込み
  - `"WQ"` : 64bit サイズでの書き込み
- 読み出し用書式 : `CMD ADDRESS COUNT`
  - 第 3 カラムに読み出す個数（1以上）を指定します
  - 読み出しアドレスは読み出しサイズでインクリメントされます
- 書き込み用書式 : `CMD ADDRESS VALUE...`
  - 各 `VALUE` の値を書き込みます（1個以上指定してください）
  - 書き込みアドレスは書き込みサイズでインクリメントされます

## 例

### `/dev/mem` の場合

アドレス `0x30000000` 以降に 32bit で {`0x12340001`, `0x12340002`, `0x12340003` } を 書き込みたい場合

```
# sudo ./mem-paio.elf wd 0x30000000 0x12340001 0x12340002 0x12340003
```

アドレス `0x30000000` から 32bit 値 3個 を 読み出したい場合

```
# sudo ./mem-paio.elf rd 0x30000000 3
```

### `/dev/uio*` の場合


```
# sudo ./mem-paio.elf --dev /dev/uio3 wd 0x30000000 0x12340001 0x12340002 0x12340003
```

アドレス `0x30000000` から 32bit 値 3個 を 読み出したい場合

```
# sudo ./mem-paio.elf --dev /dev/uio3 rd 0x30000000 3
```

#### 注

- OS や Device-Tree の設定によりアクセスが禁止されている領域は I/O できません
- UIO の場合、指定するアドレスは UIO デバイスが扱える範囲でないとエラーになります



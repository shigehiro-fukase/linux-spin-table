# mod-paio

## 概要

物理アドレスでメモリを I/O するための Linux 用ドライバモジュールです。

#### ビルド

`Makefile` 内の `KERNEL_HEADERS=` をターゲット用のビルド済み Linux カーネルソースのパスに変えてください。
また、ターゲット用の Linux カーネルビルドと同様に環境変数を設定し、ツールチェインのパスなどを整えてください。

```
$ make all
```

`mod-paio.ko` が作成されます。

#### ロード
操作前に `insmod` コマンドでモジュールのロードを行います。

```
# insmod mod-paio.ko
```

#### 操作

ロードすると `/proc/paio` が作成されます。
`/proc/paio` は `CMD ADDRESS COUNT` または `CMD ADDRESS VALUE...` 形式の文字列を受け付けます。

- `CMD`: 定義済みの名称で指定します
  - `"RB"` :  8bit サイズでの読み出し
  - `"RW"` : 16bit サイズでの読み出し
  - `"RD"` : 32bit サイズでの読み出し
  - `"RQ"` : 64bit サイズでの読み出し
  - `"WB"` :  8bit サイズでの書き込み
  - `"WW"` : 16bit サイズでの書き込み
  - `"WD"` : 32bit サイズでの書き込み
  - `"WQ"` : 64bit サイズでの書き込み
- 読み出し用書式 : `CMD ADDRESS COUNT`
  - 第 3 カラムに読み出す個数（1以上）を指定します
  - 読み出しアドレスは読み出しサイズでインクリメントされます
- 書き込み用書式 : `CMD ADDRESS VALUE...`
  - 各 `VALUE` の値を書き込みます（1個以上指定してください）
  - 書き込みアドレスは書き込みサイズでインクリメントされます

#### アンロード

```
# rmmod mod_psci
```

## 例

アドレス `0x30000000` 以降に 32bit で {`0x12340001`, `0x12340002`, `0x12340003` } を 書き込みたい場合

```
# echo "wd 0x30000000 0x12340001 0x12340002 0x12340003" > /proc/paio
```

アドレス `0x30000000` から 32bit 値 3個 を 読み出したい場合

```
# echo "rd 0x30000000 3" > /proc/paio
```

結果は `printk` で出力されます。
コンソール 又は `dmesg` で確認してください。（Linux の設定によって異なります）

